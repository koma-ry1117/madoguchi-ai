# アーキテクチャ設計

## システム全体構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                    クライアント層                                  │
│                                                                   │
│  ┌──────────────────┐              ┌───────────────────┐        │
│  │  Webブラウザ      │              │ Chrome拡張機能     │        │
│  │                  │              │ (物件取り込み)      │        │
│  │  - Next.js UI    │              │                   │        │
│  │  - React 19      │              │  Manifest V3      │        │
│  │  - Tailwind CSS  │              │  TypeScript       │        │
│  │  - shadcn/ui     │              └─────────┬─────────┘        │
│  │                  │                        │                  │
│  │  【音声入力】     │                        │ POST /api/       │
│  │  Web Audio API   │                        │ properties/import│
│  │  MediaRecorder   │                        │                  │
│  │                  │                        ▼                  │
│  │  【アバター表示】 │              ┌─────────────────┐          │
│  │  Framer Motion   │              │ Auth Token検証  │          │
│  └──────────┬───────┘              └─────────────────┘          │
│             │                                                    │
└─────────────┼────────────────────────────────────────────────────┘
              │
              │ HTTPS
              ▼
┌─────────────────────────────────────────────────────────────────┐
│                Vercel Edge Network (CDN + Edge Functions)        │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  Edge Middleware                                         │   │
│  │  - レート制限                                             │   │
│  │  - セキュリティヘッダー                                   │   │
│  │  - 認証チェック                                           │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  Next.js App Router                                      │   │
│  │                                                           │   │
│  │  - Server Components (RSC)                               │   │
│  │  - Server Actions                                        │   │
│  │  - Route Handlers (API Routes)                           │   │
│  └──────────────────────────────────────────────────────────┘   │
└───────────────────────┬──────────────────────┬──────────────────┘
                        │                      │
        ┌───────────────┘                      └───────────────┐
        │                                                      │
        ▼                                                      ▼
┌──────────────────┐                              ┌─────────────────────┐
│  Supabase        │                              │  外部APIサービス     │
│                  │                              │                     │
│ ┌──────────────┐ │                              │ ┌─────────────────┐ │
│ │ PostgreSQL   │ │                              │ │ OpenAI API      │ │
│ │ + pgvector   │ │                              │ │ - GPT-4o        │ │
│ └──────────────┘ │                              │ │ - Whisper       │ │
│                  │                              │ │ - Embeddings    │ │
│ ┌──────────────┐ │                              │ └─────────────────┘ │
│ │ Auth (JWT)   │ │                              │                     │
│ └──────────────┘ │                              │ ┌─────────────────┐ │
│                  │                              │ │ ElevenLabs API  │ │
│ ┌──────────────┐ │                              │ │ - TTS           │ │
│ │ Storage      │ │                              │ └─────────────────┘ │
│ │ - 物件画像    │ │                              │                     │
│ │ - 音声cache  │ │                              │ ┌─────────────────┐ │
│ │ - HTML保存   │ │                              │ │ Resend API      │ │
│ └──────────────┘ │                              │ │ - メール配信     │ │
│                  │                              │ │ - React Email   │ │
│ ┌──────────────┐ │                              │ └─────────────────┘ │
│ │ Realtime     │ │                              │                     │
│ │ (WebSocket)  │ │                              └─────────────────────┘
│ └──────────────┘ │
└──────────────────┘
```

---

## ドキュメント一覧

本ドキュメントは以下のサブドキュメントに分割されています：

| ドキュメント | 説明 |
|-------------|------|
| [レイヤー構成](./architecture/architecture-layers.md) | プレゼンテーション層、アプリケーション層、インフラ層、ドメイン層 |
| [データフロー](./architecture/architecture-flows.md) | 会話フロー、物件取り込み、メール通知、Webhook処理 |
| [フロントエンド構成](./architecture/architecture-frontend.md) | コンポーネント構成、ページ構成、状態管理 |
| [セキュリティ・パフォーマンス・監視](./architecture/architecture-security.md) | 認証、RLS、最適化、モニタリング |

---

次のドキュメント: [データベース設計](./database-design.md)
