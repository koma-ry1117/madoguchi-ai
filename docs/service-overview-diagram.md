# サービス全体像・アーキテクチャ図

> giyam様との認識合わせ用ドキュメント

---

## 📋 システム全体構成図

```
┌─────────────────────────────────────────────────────────────────────┐
│                         【ユーザー種別】                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  👥 顧客              👔 オペレーター           👨‍💼 管理者           │
│  ・物件検索           ・物件取り込み           ・全データ管理         │
│  ・AI対話             ・自分の物件編集         ・ユーザー管理         │
│  ・音声入力           ・顧客対応履歴確認       ・システム設定         │
│                                                                       │
└───────┬───────────────────┬────────────────────┬────────────────────┘
        │                   │                    │
        │ 📱 Webブラウザ    │ 🔧 Chrome拡張      │ 💻 管理画面
        │                   │                    │
┌───────▼───────────────────▼────────────────────▼────────────────────┐
│                                                                       │
│                      【madoguchi-ai システム】                             │
│                  不動産窓口営業アシスタント                             │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              🤖 AIアバター（名前未定）                        │   │
│  │                                                               │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐              │   │
│  │  │   通常    │  │   喜び   │  │  考え中  │  ...（5種類）  │   │
│  │  │ neutral.png│  │ happy.png │  │thinking.png│             │   │
│  │  └───────────┘  └───────────┘  └───────────┘              │   │
│  │                                                               │   │
│  │  ・感情に応じた表情切り替え                                    │   │
│  │  ・滑らかなアニメーション（Framer Motion）                     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              🎙️ 音声対応システム                               │   │
│  │                                                                │   │
│  │  【音声入力】              【音声出力】                         │   │
│  │  マイク → 録音            テキスト → 音声合成                  │   │
│  │    ↓                          ↓                              │   │
│  │  Whisper API              ElevenLabs API                      │   │
│  │  （OpenAI）               （高品質TTS）                        │   │
│  │    ↓                          ↓                              │   │
│  │  テキスト化               音声再生                             │   │
│  │                                                                │   │
│  │  ・よくある応答は事前生成してキャッシュ                          │   │
│  │  ・高齢者にも使いやすい                                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              🧠 AI会話エンジン（OpenAI GPT-4o）                 │   │
│  │                                                                │   │
│  │  【主な機能】                                                   │   │
│  │  ✓ 顧客の希望条件ヒアリング                                    │   │
│  │  ✓ 物件検索・フィルタリング                                    │   │
│  │  ✓ 物件提案・説明                                              │   │
│  │  ✓ 感情分析（アバター表情選択）                                 │   │
│  │  ✓ 会話履歴の記憶                                              │   │
│  │                                                                │   │
│  │  【RAG（検索拡張生成）】                                        │   │
│  │  顧客の質問 → ベクトル化 → 類似物件検索 → 提案                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              🏠 物件データ管理                                  │   │
│  │                                                                │   │
│  │  【Chrome拡張機能】                                            │   │
│  │  アットホーム等の物件ページ                                     │   │
│  │         ↓                                                      │   │
│  │  ワンクリックで取り込み                                         │   │
│  │         ↓                                                      │   │
│  │  GPT-4oで構造化データ抽出                                      │   │
│  │         ↓                                                      │   │
│  │  データベースに保存                                             │   │
│  │                                                                │   │
│  │  ・HTMLスナップショット保存（法的証跡）                          │   │
│  │  ・取り込みログ記録                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              📧 メール通知システム ⭐ NEW                       │   │
│  │                                                                │   │
│  │  【自動送信メール】                                             │   │
│  │  ✓ 内見予約確定メール（顧客・オペレーター）                      │   │
│  │  ✓ カレンダー招待 (.icsファイル) 添付                          │   │
│  │  ✓ 問い合わせ受付確認メール                                     │   │
│  │  ✓ システムお知らせメール                                       │   │
│  │  ✓ パスワードリセット（Supabase Auth）                          │   │
│  │                                                                │   │
│  │  【メール配信】                                                 │   │
│  │  Resend API → 美しいHTMLメール（React Email）                  │   │
│  │                                                                │   │
│  │  ・送信ログ記録（監査用）                                        │   │
│  │  ・エラー時の再送処理                                           │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└───────────────────────────┬───────────────────────────────────────┘
                            │
                            │ データ保存・取得
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      【データベース層】                                │
│                    Supabase（PostgreSQL）                            │
│                                                                       │
│  📊 物件データ  👥 顧客データ  💬 会話履歴  📝 取り込みログ           │
│  📅 内見予約  📧 メール送信ログ ⭐ NEW                                 │
│                                                                       │
│  【セキュリティ】                                                      │
│  ・Row Level Security（RLS）による権限制御                            │
│  ・データ暗号化                                                        │
│  ・自動バックアップ                                                    │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                      【外部サービス連携】                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  🤖 OpenAI API        🎤 Whisper API      🔊 ElevenLabs              │
│  ・GPT-4o会話         ・音声認識          ・音声合成                  │
│  ・構造化抽出         ・日本語対応        ・高品質日本語音声            │
│  ・感情分析                                                           │
│                                                                       │
│  📧 Resend ⭐         🗄️ Supabase         ☁️ Vercel                 │
│  ・メール配信         ・DB・Storage       ・ホスティング               │
│  ・React Email       ・認証・Realtime    ・自動スケーリング            │
│  ・カレンダー添付                                                      │
│                                                                       │
│  📊 Sentry                                                            │
│  ・エラー監視・ログ管理                                                │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🎯 主要機能フロー

### 1. 顧客の物件検索フロー

```
【顧客】
   │
   │ 1. Webサイトにアクセス
   ▼
┌──────────────────┐
│ LP（トップページ）│
└────────┬─────────┘
         │ 2. 「物件を探す」クリック
         ▼
┌──────────────────────────┐
│  顧客対応画面（メイン）     │
│                            │
│  🤖 AIアバター表示          │
│  🎙️ 音声入力ボタン           │
│  ⌨️ テキスト入力フォーム     │
└────────┬─────────────────┘
         │
         │ 3. 音声 or テキストで条件入力
         │    「文京区で2LDK、家賃15万円以内」
         ▼
┌──────────────────────────┐
│  【音声の場合】             │
│  Whisper API で文字起こし   │
│  → テキスト確認・修正可能    │
└────────┬─────────────────┘
         │
         │ 4. AI会話エンジン処理
         ▼
┌──────────────────────────┐
│  GPT-4o                   │
│  ・条件理解               │
│  ・物件検索実行           │
│  ・提案文生成             │
│  ・感情分析（表情選択）    │
└────────┬─────────────────┘
         │
         │ 5. レスポンス返却
         ▼
┌──────────────────────────┐
│  画面表示                 │
│  ・アバター表情切り替え    │
│  ・テキスト表示           │
│  ・音声再生（ElevenLabs） │
│  ・物件カード表示         │
└────────┬─────────────────┘
         │
         │ 6. 物件カードクリック
         ▼
┌──────────────────────────┐
│  物件詳細ページ           │
│  ・写真・間取り図         │
│  ・詳細情報               │
│  ・問い合わせボタン       │
└──────────────────────────┘
```

### 2. オペレーターの物件取り込みフロー

```
【オペレーター】
   │
   │ 1. アットホーム等で物件ページ表示
   ▼
┌────────────────────────────┐
│  Chrome拡張機能アイコンクリック │
└────────┬───────────────────┘
         │
         │ 2. ポップアップ表示
         │    「この物件を取り込みますか？」
         ▼
┌────────────────────────────┐
│  【取り込みボタン】クリック   │
└────────┬───────────────────┘
         │
         │ 3. HTMLデータ送信
         ▼
┌────────────────────────────┐
│  madoguchi-ai システム           │
│  ・Auth Token検証          │
│  ・権限確認                │
└────────┬───────────────────┘
         │
         │ 4. GPT-4oで構造化
         ▼
┌────────────────────────────┐
│  構造化データ抽出           │
│  {                         │
│    title: "...",          │
│    address: "...",        │
│    rent: 150000,          │
│    layout: "2LDK",        │
│    ...                    │
│  }                        │
└────────┬───────────────────┘
         │
         │ 5. データベース保存
         ▼
┌────────────────────────────┐
│  Supabase                  │
│  ・properties テーブル      │
│  ・HTMLスナップショット保存  │
│  ・取り込みログ記録         │
└────────┬───────────────────┘
         │
         │ 6. 完了通知
         ▼
┌────────────────────────────┐
│  Chrome拡張機能            │
│  「取り込み完了しました」    │
└────────────────────────────┘
```

### 3. 管理者のダッシュボード利用フロー

```
【管理者】
   │
   │ 1. 管理画面にログイン
   ▼
┌────────────────────────────┐
│  ダッシュボード              │
│                            │
│  📊 統計情報               │
│  ・本日の会話数             │
│  ・物件取り込み数           │
│  ・顧客満足度               │
│                            │
│  📝 最近の活動              │
│  ・物件取り込みログ         │
│  ・顧客問い合わせ           │
└────────┬───────────────────┘
         │
         │ 2. メニュー選択
         ▼
┌─────────┴──────┬──────────┬──────────┐
│                │          │          │
▼                ▼          ▼          ▼
物件管理         ユーザー管理  ログ確認   設定
・全物件編集     ・ロール変更   ・監査     ・システム設定
・削除           ・追加/削除    ・エラー   ・API Key管理
```

### 4. 内見予約・メール通知フロー ⭐ NEW

```
【顧客】
   │
   │ 1. 物件詳細ページで「内見予約」クリック
   ▼
┌────────────────────────────┐
│  内見予約フォーム           │
│  ・希望日時選択             │
│  ・連絡先入力               │
│  ・備考入力                 │
└────────┬───────────────────┘
         │
         │ 2. 「予約する」ボタンクリック
         ▼
┌────────────────────────────┐
│  madoguchi-ai システム           │
│  ・内見予約をDB保存         │
│  ・viewingsテーブルに記録    │
└────────┬───────────────────┘
         │
         │ 3. メール送信トリガー
         ▼
┌────────────────────────────┐
│  Resend API                │
│  ・カレンダー招待生成(.ics) │
│  ・HTMLメール作成           │
│  ・React Emailテンプレート  │
└────────┬───────────────────┘
         │
         ├─────────┬─────────┐
         │         │         │
         ▼         ▼         ▼
    【顧客】  【オペレーター】 【DB】
         │         │         │
    内見予約    内見予約通知   email_logs
    確定メール   メール       テーブルに
    + .ics添付  + .ics添付    送信記録

┌────────────────────────────┐
│  メール例（顧客宛）         │
│  ────────────────          │
│  件名: 内見予約が確定しました │
│                            │
│  〇〇様                     │
│                            │
│  以下の日時で内見予約が     │
│  確定いたしました。          │
│                            │
│  物件: 文京区2LDKマンション  │
│  日時: 2025/11/20 14:00   │
│  住所: 東京都文京区本郷...  │
│                            │
│  📎 calendar.ics          │
│  （カレンダーに追加可能）    │
└────────────────────────────┘
```

---

## 💡 システムの特徴・メリット

### 顧客視点
✅ **24時間いつでも物件検索可能**
- 営業時間外でもAIが対応
- 自分のペースで物件探し

✅ **高齢者にも優しい**
- 音声で話すだけで検索可能
- 分かりやすい説明
- 何度でも質問できる

✅ **パーソナライズされた提案**
- 会話履歴を記憶
- 好みを学習して提案

✅ **内見予約が簡単・確実 ⭐ NEW**
- ワンクリックで内見予約
- 予約確定メールで安心
- カレンダー添付で予定管理が簡単

### オペレーター視点
✅ **物件登録の効率化**
- ワンクリックで取り込み
- 自動的に構造化データ抽出
- 手入力不要

✅ **顧客対応履歴の可視化**
- どの物件が人気か把握
- 顧客の反応を分析

✅ **内見予約管理の自動化 ⭐ NEW**
- 予約通知を自動受信
- カレンダー連携で予定管理
- メール履歴で対応状況確認

### 管理者視点
✅ **セキュアな権限管理**
- ロールベースアクセス制御
- 操作ログの記録
- データ保護

✅ **運用コストの削減**
- AI自動応答で人件費削減
- スケーラブルなインフラ
- 従量課金で無駄なし

### 不動産会社視点（SaaS展開時）
✅ **低コストで導入可能**
- 初期費用不要（サブスク型）
- 月額¥30,000〜
- すぐに使い始められる

✅ **顧客満足度向上**
- 即座の対応で機会損失削減
- 丁寧な接客で信頼獲得

---

## 📱 画面構成（全7ページ）

### 1. LP（ランディングページ）
```
┌────────────────────────────┐
│  🏠 madoguchi-ai           │
│  不動産窓口営業アシスタント    │
│                            │
│  【特徴】                   │
│  ・24時間対応              │
│  ・音声で物件検索           │
│  ・高齢者にも優しい         │
│                            │
│  [物件を探す] ボタン        │
└────────────────────────────┘
```

### 2. 顧客対応画面（メイン）
```
┌────────────────────────────┐
│  🤖 AIアバター（名前未定）  │
│  「いらっしゃいませ」        │
│                            │
│  💬 会話履歴               │
│  ユーザー: ...             │
│  AI: ...                   │
│                            │
│  🎙️ [音声入力] ⌨️ テキスト  │
│                            │
│  🏠 物件カード × 3          │
└────────────────────────────┘
```

### 3. 物件詳細ページ
```
┌────────────────────────────┐
│  📷 物件写真スライダー       │
│                            │
│  🏠 2LDK マンション        │
│  📍 東京都文京区本郷        │
│  💰 家賃: ¥150,000        │
│                            │
│  【詳細情報】              │
│  ・間取り図                │
│  ・設備                   │
│  ・アクセス                │
│                            │
│  [問い合わせする] ボタン     │
└────────────────────────────┘
```

### 4. 物件一覧ページ
```
┌────────────────────────────┐
│  🔍 検索条件フィルター       │
│  エリア: [    ]            │
│  家賃: [    ] 〜 [    ]   │
│  間取り: [ 2LDK ▼]        │
│                            │
│  📋 検索結果: 25件         │
│                            │
│  🏠 物件カード             │
│  🏠 物件カード             │
│  🏠 物件カード             │
│  ...                      │
└────────────────────────────┘
```

### 5. 管理画面（オペレーター用）
```
┌────────────────────────────┐
│  📊 自分の取り込み物件       │
│                            │
│  物件ID  タイトル  登録日    │
│  #001   文京区...  11/15  │
│  #002   千代田区... 11/14  │
│                            │
│  [編集] [削除] ボタン       │
│                            │
│  📝 取り込みログ            │
└────────────────────────────┘
```

### 6. ダッシュボード（管理者用）
```
┌────────────────────────────┐
│  📊 統計情報               │
│  ┌──────┬──────┬──────┐  │
│  │本日の │物件  │顧客  │  │
│  │会話数 │取込数│満足度│  │
│  │  45  │  12  │ 4.5  │  │
│  └──────┴──────┴──────┘  │
│                            │
│  📈 グラフ（会話数推移）     │
│                            │
│  📝 最近の活動              │
└────────────────────────────┘
```

### 7. 設定ページ
```
┌────────────────────────────┐
│  ⚙️ システム設定            │
│                            │
│  【アバター設定】           │
│  ・表情切り替え速度         │
│  ・デフォルト表情           │
│                            │
│  【音声設定】              │
│  ・音声合成速度             │
│  ・音量                    │
│                            │
│  【API設定】（管理者のみ）  │
│  ・OpenAI API Key         │
│  ・ElevenLabs API Key     │
└────────────────────────────┘
```

---

## 🔐 セキュリティ対策

### 認証・認可
- Supabase Auth（JWT）による認証
- Row Level Security（RLS）による権限制御
- ロールベースアクセス制御（customer/operator/admin）

### データ保護
- HTTPS強制通信
- データベース暗号化
- 機密情報の追加暗号化
- 自動バックアップ

### 監査・ログ
- 物件取り込みログ記録（法的証跡）
- HTMLスナップショット保存
- アクセスログ記録
- セキュリティイベント監視

---

## 📊 技術スタック概要

| レイヤー | 技術 | 説明 |
|---------|------|------|
| フロントエンド | Next.js 15 + React 19 | モダンWebアプリ |
| UI | Tailwind CSS + shadcn/ui | 美しいUI |
| アニメーション | Framer Motion | 滑らかなアバター切り替え |
| バックエンド | Supabase（PostgreSQL） | データベース・認証・Storage |
| ホスティング | Vercel | 高速・自動スケーリング |
| AI会話 | OpenAI GPT-4o | 自然な会話・物件提案 |
| 音声認識 | Whisper API | 音声→テキスト |
| 音声合成 | ElevenLabs | テキスト→高品質音声 |
| メール配信 ⭐ | Resend + React Email | HTMLメール・カレンダー添付 |
| 物件取り込み | Chrome拡張（Manifest V3） | ワンクリック取り込み |
| セキュリティ | Row Level Security（RLS） | データ保護 |
| 監視 | Sentry + Axiom | エラー監視・ログ管理 |

---

## 💰 コスト概要

### 開発費用
- **総額**: ¥3,500,000（税込）
  - 月額保証: ¥100,000/月 × 5ヶ月 = ¥500,000
  - 成功報酬: ¥3,000,000（納品・検収完了後）

### 月次費用（運用開始後）
- **外部APIサービス**: 約¥22,000/月
  - OpenAI API: ¥5,500
  - Whisper API: ¥3,300
  - ElevenLabs API: ¥4,400
  - Resend（メール配信）: ¥0（無料枠内） ⭐
  - Supabase: ¥2,750
  - Vercel: ¥2,750
  - その他監視: ¥3,300

### 年間コスト（1年目）
- 開発費用 + 運用費用 = 約¥3,839,000

### 年間コスト（2年目以降）
- 運用費用のみ = 約¥264,000

---

## 🎯 期待される効果

### 定量的効果
- 📞 **顧客対応件数**: 月300件 → 月500件（+67%）
- ⏰ **営業時間外対応**: 0件 → 月200件
- 💰 **人件費削減**: 月¥300,000削減（1次対応自動化）
- 📈 **成約率向上**: 15% → 20%（+5%）

### 定性的効果
- 😊 **顧客満足度向上**: 即座の対応で機会損失削減
- 🚀 **業務効率化**: オペレーターは質の高い対応に集中
- 📱 **ブランド向上**: 先進的なイメージ
- 🌐 **SaaS展開可能**: 他社への横展開でビジネス拡大

---

## 📅 開発スケジュール

| 期間 | フェーズ | 主な成果物 |
|-----|---------|----------|
| 1ヶ月目 | Phase 1: 基盤構築 | データベース設計完了 |
| 2ヶ月目 | Phase 2: Chrome拡張・物件管理 | 物件取り込み機能完成 |
| 3ヶ月目 | Phase 3&4: AI・音声統合 | AI会話・音声機能完成 |
| 4ヶ月目 | Phase 5: UI/UX・アバター | 全7ページ完成 |
| 5ヶ月目 | Phase 6&7: テスト・デプロイ | 本番リリース |

---

## ✅ 確認事項

### このシステムで実現できること
- ✅ 24時間AIによる自動物件提案
- ✅ 音声での物件検索
- ✅ 感情表現豊かなアバター表示
- ✅ Chrome拡張でワンクリック物件取り込み
- ✅ セキュアな権限管理
- ✅ 会話履歴の記録・分析
- ✅ 内見予約の自動メール通知
- ✅ 問い合わせ受付確認メールの自動送信
- ✅ システムお知らせメールの一斉配信

### このシステムでできないこと
- ❌ 3Dアバター（2D静止画のみ）
- ❌ リアルタイム動画通話
- ❌ 完全自動の物件取り込み（人手でワンクリック必要）
- ❌ オペレーターのスケジュール自動調整（予約受付・メール送信まで）

---

## 🤝 次のステップ

1. **この資料を確認**していただき、認識の相違がないかご確認ください
2. **ご質問・ご要望**がありましたら、お気軽にお知らせください
3. **ご承認**いただけましたら、開発着手いたします

---

**発行者**: 小松原遼羽
**連絡先**: r.kono17y204@gmail.com / 070-1317-5266
**発行日**: 2025年11月15日
